---
# Cribl Edge Docker Compose configuration
# Generated by Ansible

services:
  cribl-edge:
    image: {{ cribl_edge_docker_image }}
    container_name: {{ cribl_edge_container_name }}
    hostname: {{ hostname }}
    restart: unless-stopped
    environment:
      - CRIBL_EDGE=1
      - CRIBL_HOME=/opt/cribl
    ports:
{% for port_config in cribl_edge_syslog_ports %}
      - "{{ port_config.port }}:{{ port_config.port }}/{{ port_config.protocol }}"
{% endfor %}
      # Web UI (for debugging and configuration)
      - "9000:9000"
    volumes:
      # Persistent data (queue, state)
      - {{ cribl_edge_data_dir }}:/opt/cribl/state
      # Configuration overlay
      - {{ cribl_edge_config_dir }}/local:/opt/cribl/local
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9000/api/v1/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s
