---
# HAProxy + Nginx Stream Load Balancer role defaults

# Package management
haproxy_package_name: haproxy
haproxy_nginx_package_name: nginx

# Service configuration
haproxy_service_name: haproxy
haproxy_service_state: started
haproxy_service_enabled: true

haproxy_nginx_service_name: nginx
haproxy_nginx_service_state: started
haproxy_nginx_service_enabled: true

# HAProxy: TCP/HTTP ports
haproxy_listen_ports:
  - 1514
  - 1515
  - 1516
  - 1517
  - 1518
  - 2055

# Nginx Stream: UDP ports for syslog/NetFlow
haproxy_nginx_udp_ports:
  - 1514
  - 1515
  - 1516
  - 1517
  - 1518
  - 2055

# Backend configuration - Cribl Edge nodes
# Used by both HAProxy (TCP) and Nginx (UDP)
haproxy_backends:
  - name: cribl-edge-01
    host: "{{ hostvars['cribl_edge_01'].hostname }}.{{ internal_domain }}"
    ip: "{{ hostvars['cribl_edge_01'].ansible_host }}"
    port: 1514
  - name: cribl-edge-02
    host: "{{ hostvars['cribl_edge_02'].hostname }}.{{ internal_domain }}"
    ip: "{{ hostvars['cribl_edge_02'].ansible_host }}"
    port: 1514

# Health check configuration
haproxy_health_check_interval: 5000
haproxy_health_check_timeout: 5000

# Statistics dashboard
haproxy_stats_enabled: true
haproxy_stats_port: 8404
haproxy_stats_user: admin
# NOTE: Use a strong password from Doppler secrets in production
# This default is intentionally weak - override with vault lookup
haproxy_stats_password: "{{ lookup('env', 'HAPROXY_STATS_PASSWORD') | default('CHANGEME') }}"

# Load balancing algorithm (used by both HAProxy and Nginx)
haproxy_algorithm: roundrobin

# Configuration files
haproxy_config_file: /etc/haproxy/haproxy.cfg
haproxy_nginx_config_file: /etc/nginx/nginx.conf
haproxy_nginx_stream_config_file: /etc/nginx/streams.d/syslog-lb.conf
