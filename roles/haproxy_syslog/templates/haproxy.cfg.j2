global
  log stdout local0
  log stdout local1 notice
  chroot /var/lib/haproxy
  stats socket /run/haproxy/admin.sock mode 660 level admin
  stats timeout 30s
  user haproxy
  group haproxy
  daemon

  # Default SSL material locations
  ca-base /etc/ssl/certs
  crl-base /etc/ssl/private

  # See the full configuration options online.
  # https://www.haproxy.org/

defaults
  log global
  mode tcp
  option tcplog
  timeout connect 5000
  timeout client 60000
  timeout server 60000

# Statistics dashboard
{% if haproxy_syslog_stats_enabled %}
listen stats
  bind *:{{ haproxy_syslog_stats_port }}
  stats enable
  stats uri /stats
  stats refresh 10s
  stats admin if TRUE
  stats auth {{ haproxy_syslog_stats_user }}:{{ haproxy_syslog_stats_password }}
{% endif %}

# Syslog load balancing frontends and backend
{% for port in haproxy_syslog_listen_ports %}
# Syslog frontend on port {{ port }}
frontend syslog_tcp_{{ port }}
  mode tcp
  bind *:{{ port }} proto tcp
  default_backend syslog_backend

frontend syslog_udp_{{ port }}
  mode udp
  bind *:{{ port }} proto udp
  default_backend syslog_backend_udp

{% endfor %}

# TCP backend for syslog servers
backend syslog_backend
  mode tcp
  balance {{ haproxy_syslog_algorithm }}
  option tcp-check
{% for backend in haproxy_syslog_backends %}
  server {{ backend.name }} {{ backend.ip }}:{{ backend.port }} check inter {{ haproxy_syslog_health_check_interval }} timeout {{ haproxy_syslog_health_check_timeout }}
{% endfor %}

# UDP backend for syslog servers
backend syslog_backend_udp
  mode udp
  balance {{ haproxy_syslog_algorithm }}
{% for backend in haproxy_syslog_backends %}
  server {{ backend.name }} {{ backend.ip }}:{{ backend.port }}
{% endfor %}
